<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat-Memo</title>
  <link href="../lib/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../lib/fontawesome/all.min.css">
  <style>
    :root {
      --primary-color: #3b82f6;
      --primary-hover: #2563eb;
      --bg-color: #f9fafb;
      --card-bg: #ffffff;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --border-color: #e5e7eb;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --radius: 0.5rem;
    }
    
    /* 自定义数据概览图标是否展示的断点 */
    .hidden-custom {
      display: none;
    }
    
    @media (min-width: 420px) {
      .show-custom-icon {
        display: flex;
      }
    }
    
    body {
      min-width: 300px;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      overflow: hidden; /* Prevent whole page scrolling */
      display: flex;
      flex-direction: row;
      background-color: var(--bg-color);
      color: var(--text-primary);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: flex;
      flex-direction: column;
    }
    
    .memory-card {
      transition: all 0.2s ease;
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
    }
    
    .memory-card:hover {
      /* box-shadow: var(--shadow-md); */ /* Removed hover effect */
      /* transform: translateY(-2px); */ /* Removed hover effect */
      border-color: #d1d5db; /* Keep border highlight or remove if no visual change desired */
    }
    
    /* 卡片交互按钮hover效果 */
    .memory-card:hover .card-action {
      opacity: 1;
    }
    
    /* 卡片交互按钮样式优化 */
    .card-action {
      transition: opacity 0.2s ease;
    }
    
    .card-action button {
      transition: all 0.15s ease;
    }
    
    .card-action button:hover {
      background-color: rgba(0, 0, 0, 0.05);
      transform: scale(1.1);
    }
    
    /* 统一的平台标签样式 */
    .platform-tag {
      font-size: 0.65rem;
      padding: 0.125rem 0.375rem;
      border-radius: 4px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      background-color: #e6f7f5;
      color: #0d9488;
      white-space: nowrap; /* 防止换行 */
      flex-shrink: 0; /* 防止被压缩 */
    }
    
    /* 标签容器动态内边距样式 */
    .platform-tags-container-with-tags {
      padding: 0.375rem 0.375rem !important; /* py-1.5 px-3 减少内边距 */
    }
    
    .platform-tags-container-empty {
      padding: 0.5rem 0.5rem !important; /* py-2 px-3 保持原有高度 */
    }
    
    /* 移除小点点样式 */
    /* .platform-tag::before {
      content: '';
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      margin-right: 3px;
      background-color: #0d9488;
    } */
    
    /* 保持向后兼容性的平台特定样式（继承统一样式）*/
    .platform-deepseek,
    .platform-chatgpt,
    .platform-gemini,
    .platform-yuanbao,
    .platform-doubao,
    .platform-claude {
      /* 所有平台使用相同的统一样式，这些类名仅用于标识 */
      display: inline-block;
    }
    
    /* 移除固定高度，使用flex布局自适应 */
    
    /* 开关样式 */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.3s;
      border-radius: 24px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.3s;
      border-radius: 50%;
    }
    
    .toggle-switch input:checked + .toggle-slider {
      background-color: #3b82f6;
    }
    
    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(20px);
    }
    
    .thinking-block {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 1px solid #e2e8f0;
      padding: 12px 16px;
      margin: 12px 0;
      border-radius: 8px;
      font-size: 13px;
      color: #475569;
      position: relative;
      transition: all 0.2s ease;
    }
    
    .thinking-block:hover {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    }
    
    .thinking-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
      padding: 4px 0;
    }
    
    .thinking-toggle:hover {
      color: #334155;
    }
    
    .thinking-title {
      color: #64748b !important;
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
    }
    
    .thinking-arrow {
      width: 0;
      height: 0;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-top: 8px solid #94a3b8;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 2px;
    }
    
    .thinking-arrow:hover {
      border-top-color: #64748b;
    }
    
    .thinking-arrow.open {
      border-top: none;
      border-bottom: 8px solid #94a3b8;
      margin-top: -2px;
    }
    
    .thinking-arrow.open:hover {
      border-bottom-color: #64748b;
    }
    
    .thinking-content {
      padding-top: 8px;
    }
    
    .thinking-content div {
      margin: 0;
      padding: 0;
    }
    
    .message-user {
      background-color: #e6f0ff;
      border: 1px solid transparent;
      border-left: 4px solid #3b82f6;
      margin-bottom: 16px;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 4px rgba(59, 130, 246, 0.08);
      position: relative;
      transition: all 0.2s ease;
    }
    
    .message-user:hover {
      box-shadow: 0 4px 8px rgba(59, 130, 246, 0.12);
      transform: translateY(-1px);
    }
    
    .message-ai {
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      border: 1px solid #e5e7eb;
      border-left: 4px solid #10b981;
      margin-bottom: 16px;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 4px rgba(16, 185, 129, 0.08);
      position: relative;
      transition: all 0.2s ease;
    }
    
    .message-ai:hover {
      box-shadow: 0 4px 8px rgba(16, 185, 129, 0.12);
      transform: translateY(-1px);
    }
    
    .message-sender {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 8px;
      display: inline-flex;
      align-items: center;
      padding: 4px 8px;
      border-radius: 6px;
      position: relative;
    }
    
    .message-user .message-sender {
      background-color: rgba(59, 130, 246, 0.1);
      color: #1e40af;
    }
    
    .message-ai .message-sender {
      background-color: rgba(16, 185, 129, 0.1);
      color: #047857;
    }
    
    .message-sender::before {
      content: '';
      width: 6px;
      height: 6px;
      border-radius: 50%;
      margin-right: 6px;
    }
    
    .message-user .message-sender::before {
      background-color: #3b82f6;
    }
    
    .message-ai .message-sender::before {
      background-color: #10b981;
    }
    
    .message-content {
      line-height: 1.7;
      font-size: 14px;
      color: #1f2937;
      margin-top: 12px;
      word-wrap: break-word;
      overflow-wrap: break-word;
      white-space: pre-wrap; /* 保持原有的空格和换行格式 */
    }
    
    /* 消息展开/收折样式 */
    .message-content-wrapper {
      position: relative;
    }
    
    .message-content.collapsed {
      max-height: 150px;
      overflow: hidden;
      position: relative;
    }
    
    .message-user .message-content.collapsed::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: linear-gradient(transparent, #dbeafe);
      pointer-events: none;
    }
    
    .message-ai .message-content.collapsed::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: linear-gradient(transparent, #f3f4f6);
      pointer-events: none;
    }
    
    .message-toggle {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-top: 8px;
      padding: 4px 8px;
      background-color: rgba(59, 130, 246, 0.1);
      color: #3b82f6;
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .message-toggle:hover {
      background-color: rgba(59, 130, 246, 0.15);
      border-color: rgba(59, 130, 246, 0.3);
      transform: translateY(-1px);
    }
    
    .message-toggle i {
      font-size: 10px;
      transition: transform 0.2s ease;
    }
    
    .message-toggle.expanded i {
      transform: rotate(180deg);
    }
    
    .message-timestamp {
      font-size: 11px;
      color: #6b7280;
      font-weight: 500;
      position: absolute;
      top: 16px;
      right: 16px;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 2px 6px;
      border-radius: 4px;
      backdrop-filter: blur(4px);
    }
    
    /* 滚动条美化 */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
    
    /* 侧边栏样式 */
    .sidebar {
      width: 60px;
      background-color: #ffffff;
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px 0;
      gap: 16px;
      flex-shrink: 0;
      order: 0; /* 放在左侧 */
    }
    
    .sidebar-btn {
      width: 40px;
      height: 40px;
      border: none;
      background: transparent;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #6b7280;
      font-size: 16px;
    }
    
    .sidebar-btn:hover {
      background-color: #f3f4f6;
      color: #374151;
    }
    
    .sidebar-btn.active {
      background-color: #3b82f6;
      color: white;
    }
    
    /* 侧边栏间隔器，用于将联系我们按钮推到底部 */
    .sidebar-spacer {
      flex: 1;
    }
    
    /* 联系我们按钮样式 - 与其他按钮大小一致 */
    .contact-btn {
      margin-bottom: 8px;
      opacity: 0.8;
    }
    
    .contact-btn:hover {
      background-color: #f3f4f6 !important;
      color: #374151 !important;
      opacity: 1;
    }
    
    /* 主要内容区域 */
    .main-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100vh; /* Full viewport height */
      overflow-y: auto; /* Allow vertical scrolling for main content */
      order: 1;
    }
    
    /* 自定义日期选择器样式 */
    .date-grid button {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 32px;
      border: none;
      background: none;
      cursor: pointer;
      font-family: inherit;
    }
    
    .date-grid button:disabled {
      cursor: not-allowed;
      opacity: 0.3;
    }
    
    .date-grid button:focus {
      outline: 2px solid #3b82f6;
      outline-offset: -2px;
    }
    
    /* 日期选择器动画 */
    .date-picker-enter {
      opacity: 0;
      transform: scale(0.95);
    }
    
    .date-picker-enter-active {
      opacity: 1;
      transform: scale(1);
      transition: opacity 150ms ease, transform 150ms ease;
    }
    
    /* 日期输入框焦点样式 */
    input[readonly]:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    /* Toast 样式 - 类似 antd message */
    #toast-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    
    .toast {
      background-color: #ffffff;
      border-radius: 8px;
      padding: 8px 12px;
      box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.08), 0 2px 4px -2px rgba(0, 0, 0, 0.12), 0 6px 20px 6px rgba(0, 0, 0, 0.05);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: #000000d9;
      opacity: 0;
      transform: translateY(100%);
      transition: all 0.3s cubic-bezier(0.78, 0.14, 0.15, 0.86);
      pointer-events: auto;
      white-space: nowrap;
      z-index: 1000;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .toast.success i {
      color: #52c41a;
      font-size: 14px;
    }
    
    .toast.error i {
      color: #ff4d4f;
      font-size: 14px;
    }
    
    .toast.warning i {
      color: #faad14;
      font-size: 14px;
    }
    
    .toast.info i {
      color: #1890ff;
      font-size: 14px;
    }

    /* Fuzzy Search Highlight Styles */
    mark.highlight {
      background-color: #fef08a;
      color: #000;
      padding: 0 2px;
      border-radius: 2px;
      font-weight: 500;
    }

    /* Resizable Sidebar - Responsive Breakpoints */
    /* Narrow sidebar (<450px) - vertical stacking */
    .sidebar-narrow .stats-container {
      grid-template-columns: 1fr;
    }

    .sidebar-narrow .preview-text {
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Wide sidebar (≥450px) - horizontal layout */
    .sidebar-wide .stats-container {
      grid-template-columns: 1fr 1fr;
    }

    .sidebar-wide .preview-text {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Very wide sidebar (>600px) */
    body:not(.sidebar-narrow).sidebar-wide .preview-text {
      -webkit-line-clamp: 3;
    }

    /* Resize handle styles */
    .resize-handle {
      position: absolute;
      left: 0;
      top: 0;
      width: 5px;
      height: 100%;
      cursor: col-resize;
      z-index: 1000;
      background-color: transparent;
      transition: background-color 0.2s ease;
    }

    .resize-handle:hover {
      background-color: rgba(59, 130, 246, 0.2);
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- 主要内容区域 -->
  <div class="main-container">
    <!-- 数据概览 -->
    <header class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 border-b relative">
      <!-- 关闭侧边栏按钮 -->
      <button id="close-sidebar-btn" class="absolute top-3 right-3 w-8 h-8 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-white/50 rounded-md transition-all duration-200 z-10" title="关闭侧边栏">
        <i class="fas fa-times text-lg"></i>
      </button>

      <div class="grid grid-cols-2 gap-4">
        <div class="bg-white rounded-lg p-3 shadow-sm">
          <div class="flex items-center justify-between h-full">
            <div class="flex flex-col justify-center">
              <p class="text-xs text-gray-500 mb-1" data-i18n="totalConversations">总对话数</p>
              <p id="total-conversations" class="text-2xl font-bold text-blue-600 m-0">0</p>
            </div>
            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center overflow-hidden flex-shrink-0 hidden-custom show-custom-icon ml-3">
              <i class="fas fa-comments text-blue-600"></i>
            </div>
          </div>
        </div>
        <div class="bg-white rounded-lg p-3 shadow-sm">
          <div class="flex items-center justify-between h-full">
            <div class="flex flex-col justify-center">
              <p class="text-xs text-gray-500 mb-1" data-i18n="todayNew">今日新增</p>
              <p id="today-conversations" class="text-2xl font-bold text-green-600 m-0">0</p>
            </div>
            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center overflow-hidden flex-shrink-0 hidden-custom show-custom-icon ml-3">
              <i class="fas fa-plus text-green-600"></i>
            </div>
          </div>
        </div>
      </div>
    </header>
    
    <!-- 记忆列表标签页 -->
    <div id="memories-content" class="tab-content active flex-1 flex flex-col p-2">
      <!-- 搜索框 -->
      <div id="search-container" class="mb-2 relative">
        <div class="relative">
          <input 
            type="text" 
            id="search-input" 
            class="w-full pl-8 pr-16 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" 
            data-i18n-placeholder="searchPlaceholder" 
            placeholder="搜索对话标题或内容..."
          >
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <i class="fas fa-search text-gray-400"></i>
          </div>
          <div class="absolute inset-y-0 right-0 flex items-center">
            <button 
              id="clear-search" 
              class="p-1 mr-1 flex items-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-all duration-200 hidden"
              data-i18n-title="清除搜索"
              title="清除搜索"
            >
              <i class="fas fa-times text-sm"></i>
            </button>
            <button 
              id="filter-toggle" 
              class="p-1 mr-2 flex items-center text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded transition-all duration-200 relative"
              data-i18n-title="filter"
              title="筛选"
            >
              <i id="filter-icon" class="fas fa-filter text-sm"></i>
            </button>
          </div>
        </div>
        
        <!-- 筛选下拉菜单 -->
        <div id="filter-dropdown" class="absolute z-50 top-full right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-xl hidden transform transition-opacity transition-transform duration-200 opacity-0 scale-95">
          <div class="p-4">

            
            <!-- 日期筛选 -->
            <div class="mb-4">
              <label class="block text-xs font-medium text-gray-700 mb-2" data-i18n="dateRange">日期范围</label>
              
              <!-- 快捷日期选项 -->
              <div class="flex flex-wrap gap-2 mb-3 items-center">
                <button id="date-week" class="px-2 py-1 text-xs bg-gray-100 text-gray-700 hover:bg-blue-100 hover:text-blue-700 rounded transition-all duration-200" data-i18n="lastWeek">最近一周</button>
                <button id="date-month" class="px-2 py-1 text-xs bg-gray-100 text-gray-700 hover:bg-blue-100 hover:text-blue-700 rounded transition-all duration-200" data-i18n="lastMonth">最近一月</button>
              </div>
              
              <!-- 日期输入框 -->
              <div class="grid grid-cols-2 gap-3">
                <div class="relative">
                  <label class="block text-xs text-gray-500 mb-1" data-i18n="startDate">开始日期</label>
                  <div class="relative">
                    <input 
                      type="text" 
                      id="start-date" 
                      class="w-full px-3 py-2 pr-3 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer"
                      placeholder="yyyy/mm/dd"
                      readonly
                    >
                    <!-- 清除按钮 -->
                    <button 
                      type="button" 
                      id="start-date-clear" 
                      class="absolute right-8 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors duration-200 hidden"
                      title="清除开始日期"
                    >
                      <i class="fas fa-times text-xs"></i>
                    </button>
                    <i class="fas fa-calendar-alt absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none text-xs"></i>
                    <!-- 自定义日期选择器 -->
                    <div id="start-date-picker" class="absolute z-30 top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-xl hidden w-64">
                      <div class="p-3">
                        <!-- 年月选择器 -->
                        <div class="flex items-center justify-between mb-3">
                          <!-- 左侧导航按钮组 -->
                          <div class="flex items-center gap-1">
                            <!-- 年份导航 -->
                            <button type="button" class="date-nav-btn p-1 hover:bg-gray-100 rounded" data-action="prev-year">
                              <i class="fas fa-angle-double-left text-xs"></i>
                            </button>
                            <!-- 月份导航 -->
                            <button type="button" class="date-nav-btn p-1 hover:bg-gray-100 rounded" data-action="prev-month">
                              <i class="fas fa-chevron-left text-xs"></i>
                            </button>
                          </div>
                          <!-- 年月显示区域 -->
                          <div class="flex items-center gap-2">
                            <span class="year-display text-xs font-medium text-gray-700"></span>
                            <span class="month-display text-xs font-medium text-gray-700"></span>
                          </div>
                          <!-- 右侧导航按钮组 -->
                          <div class="flex items-center gap-1">
                            <!-- 月份导航 -->
                            <button type="button" class="date-nav-btn p-1 hover:bg-gray-100 rounded" data-action="next-month">
                              <i class="fas fa-chevron-right text-xs"></i>
                            </button>
                            <!-- 年份导航 -->
                            <button type="button" class="date-nav-btn p-1 hover:bg-gray-100 rounded" data-action="next-year">
                              <i class="fas fa-angle-double-right text-xs"></i>
                            </button>
                          </div>
                        </div>
                        <!-- 星期标题 -->
                        <div class="grid grid-cols-7 gap-1 mb-2">
                          <div class="text-center text-xs font-medium text-gray-500 py-1">日</div>
                          <div class="text-center text-xs font-medium text-gray-500 py-1">一</div>
                          <div class="text-center text-xs font-medium text-gray-500 py-1">二</div>
                          <div class="text-center text-xs font-medium text-gray-500 py-1">三</div>
                          <div class="text-center text-xs font-medium text-gray-500 py-1">四</div>
                          <div class="text-center text-xs font-medium text-gray-500 py-1">五</div>
                          <div class="text-center text-xs font-medium text-gray-500 py-1">六</div>
                        </div>
                        <!-- 日期网格 -->
                        <div class="date-grid grid grid-cols-7 gap-1"></div>
                        <!-- 底部按钮 -->
                        <div class="flex justify-center mt-3 pt-2 border-t border-gray-100">
                          <button type="button" class="date-today-btn text-xs text-blue-600 hover:text-blue-800 font-medium">今天</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="relative">
                  <label class="block text-xs text-gray-500 mb-1" data-i18n="endDate">结束日期</label>
                  <div class="relative">
                    <input 
                      type="text" 
                      id="end-date" 
                      class="w-full px-3 py-2 pr-3 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer"
                      placeholder="yyyy/mm/dd"
                      readonly
                    >
                    <!-- 清除按钮 -->
                    <button 
                      type="button" 
                      id="end-date-clear" 
                      class="absolute right-8 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors duration-200 hidden"
                      title="清除结束日期"
                    >
                      <i class="fas fa-times text-xs"></i>
                    </button>
                    <i class="fas fa-calendar-alt absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none text-xs"></i>
                    <!-- 自定义日期选择器 -->
                    <div id="end-date-picker" class="absolute z-30 top-full right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-xl hidden w-64">
                      <div class="p-3">
                        <!-- 年月选择器 -->
                        <div class="flex items-center justify-between mb-3">
                          <!-- 左侧导航按钮组 -->
                          <div class="flex items-center gap-1">
                            <!-- 年份导航 -->
                            <button type="button" class="date-nav-btn p-1 hover:bg-gray-100 rounded" data-action="prev-year">
                              <i class="fas fa-angle-double-left text-xs"></i>
                            </button>
                            <!-- 月份导航 -->
                            <button type="button" class="date-nav-btn p-1 hover:bg-gray-100 rounded" data-action="prev-month">
                              <i class="fas fa-chevron-left text-xs"></i>
                            </button>
                          </div>
                          <!-- 年月显示区域 -->
                          <div class="flex items-center gap-2">
                            <span class="year-display text-xs font-medium text-gray-700"></span>
                            <span class="month-display text-xs font-medium text-gray-700"></span>
                          </div>
                          <!-- 右侧导航按钮组 -->
                          <div class="flex items-center gap-1">
                            <!-- 月份导航 -->
                            <button type="button" class="date-nav-btn p-1 hover:bg-gray-100 rounded" data-action="next-month">
                              <i class="fas fa-chevron-right text-xs"></i>
                            </button>
                            <!-- 年份导航 -->
                            <button type="button" class="date-nav-btn p-1 hover:bg-gray-100 rounded" data-action="next-year">
                              <i class="fas fa-angle-double-right text-xs"></i>
                            </button>
                          </div>
                        </div>
                        <!-- 星期标题 -->
                        <div class="grid grid-cols-7 gap-1 mb-2">
                          <div class="text-center text-xs font-medium text-gray-500 py-1">日</div>
                          <div class="text-center text-xs font-medium text-gray-500 py-1">一</div>
                          <div class="text-center text-xs font-medium text-gray-500 py-1">二</div>
                          <div class="text-center text-xs font-medium text-gray-500 py-1">三</div>
                          <div class="text-center text-xs font-medium text-gray-500 py-1">四</div>
                          <div class="text-center text-xs font-medium text-gray-500 py-1">五</div>
                          <div class="text-center text-xs font-medium text-gray-500 py-1">六</div>
                        </div>
                        <!-- 日期网格 -->
                        <div class="date-grid grid grid-cols-7 gap-1"></div>
                        <!-- 底部按钮 -->
                        <div class="flex justify-center mt-3 pt-2 border-t border-gray-100">
                          <button type="button" class="date-today-btn text-xs text-blue-600 hover:text-blue-800 font-medium">今天</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 平台筛选 -->
            <div class="mb-4">
              <label class="block text-xs font-medium text-gray-700 mb-2" data-i18n="platformSource">平台来源</label>
              <div class="relative">
                <!-- 已选择的平台标签容器 -->
                <div 
                  id="platform-tags-container" 
                  class="min-h-[2.5rem] w-full px-3 py-2 bg-white border border-gray-300 rounded-md transition-all duration-200 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  tabindex="0"
                >
                  <div id="platform-tags" class="flex flex-wrap gap-1 items-center">
                    <!-- 平台标签将动态添加在这里 -->
                    <span id="platform-placeholder" class="text-xs text-gray-500" data-i18n="selectPlatforms">点击选择平台</span>
                  </div>
                </div>
                
                <!-- 平台选择下拉菜单 - 动态生成 -->
                <div id="platform-dropdown-menu" class="absolute z-30 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg hidden max-h-40 overflow-y-auto transform transition-all duration-200 opacity-0 scale-95">
                  <!-- 平台选项将通过 JavaScript 动态生成 -->
                </div>
              </div>
            </div>
            
            <!-- 操作按钮 -->
            <div class="flex gap-2 pt-0">
              <button 
                id="apply-filter" 
                class="flex-1 px-4 py-2 text-xs font-medium bg-blue-50 text-blue-600 rounded-md hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 transition-all duration-200"
                data-i18n="applyFilter"
              >
                <i class="fas fa-check mr-1"></i>应用筛选
              </button>
              <button 
                id="clear-filter" 
                class="flex-1 px-4 py-2 text-xs font-medium bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1 transition-all duration-200"
                data-i18n="clearFilter"
              >
                <i class="fas fa-eraser mr-1"></i>清空筛选
              </button>
            </div>
          </div>
        </div>
        
        <!-- 搜索结果信息栏 -->
        <div id="search-result-info" class="hidden mt-2 flex items-center justify-between bg-blue-50 border border-blue-200 rounded-md px-2 py-1">
          <div class="flex items-center text-xs text-blue-700">
            <i class="fas fa-info-circle mr-1.5 text-xs"></i>
            <span id="result-count-text" data-i18n="foundItems" data-i18n-args='{"count": 0}'>找到 0 条</span>
          </div>
          <div class="flex items-center gap-1.5">
            <button 
              id="sort-toggle" 
              class="px-2 py-1 text-xs text-gray-500 rounded hover:bg-blue-100 hover:text-blue-700 focus:outline-none transition-all duration-200 flex items-center gap-1"
              title="切换排序: 相关性/时间"
            >
              <i id="sort-icon" class="fas fa-calendar-alt text-xs"></i>
              <span id="sort-label" class="hidden sm:inline">时间</span>
            </button>
            <button 
              id="multi-select-toggle" 
              class="px-2 py-1 text-xs text-gray-500 rounded hover:bg-blue-100 hover:text-blue-700 focus:outline-none transition-all duration-200 flex items-center gap-1"
              data-i18n-title="multiSelectMode"
            >
              <i class="fas fa-tasks text-xs"></i>
              <span data-i18n="multiSelect">多选</span>
            </button>
            <div class="relative">
              <button 
                id="export-filtered-btn" 
                class="px-2 py-1 text-xs font-medium bg-blue-500 text-white rounded hover:bg-blue-600 focus:outline-none transition-all duration-200 flex items-center gap-1 disabled:bg-gray-400 disabled:cursor-not-allowed"
                data-i18n-title="exportFilterResults"
              >
                <i class="fas fa-download text-xs"></i>
                <span data-i18n="export">导出</span>
                <i class="fas fa-chevron-down text-xs"></i>
              </button>
              <div id="export-filtered-dropdown" class="absolute top-full right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 hidden overflow-hidden min-w-max">
                <button id="export-filtered-separate" class="w-full px-3 py-2 text-left text-xs hover:bg-gray-50 transition-colors whitespace-nowrap flex items-center border-b border-gray-100">
                  <i class="fas fa-copy mr-2 text-gray-500 w-3 text-center text-xs"></i>
                  <span class="text-gray-700" data-i18n="exportSeparate">分别导出</span>
                </button>
                <button id="export-filtered-merged" class="w-full px-3 py-2 text-left text-xs hover:bg-gray-50 transition-colors whitespace-nowrap flex items-center">
                  <i class="fas fa-compress-alt mr-2 text-gray-500 w-3 text-center text-xs"></i>
                  <span class="text-gray-700" data-i18n="exportMerged">合并导出</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 加载中 -->
      <div id="memories-loading" class="flex-1 flex items-center justify-center">
        <div class="text-center">
          <i class="fas fa-spinner fa-spin text-2xl text-gray-400 mb-2"></i>
          <p class="text-gray-500" data-i18n="loadingMemories">加载记忆中...</p>
        </div>
      </div>
      
      <!-- 空状态 -->
      <div id="memories-empty" class="hidden flex-1 flex items-center justify-center">
        <div class="text-center">
          <i class="fas fa-brain text-4xl text-gray-300 mb-3"></i>
          <p class="text-gray-500 mb-2" data-i18n="noMemoriesSaved">还没有保存任何记忆</p>
          <p class="text-sm text-gray-400" data-i18n="visitSupportedPages">访问支持的 AI 聊天页面开始记录对话</p>
        </div>
      </div>
      
      <!-- 记忆列表 -->
      <div id="memories-list" class="hidden flex-1 overflow-y-auto">
        <div class="grid gap-2 grid-cols-1 pb-2">
          <!-- 卡片将通过JavaScript动态插入 -->
        </div>
      </div>
    </div>
    
    <!-- 对话详情页面 (现在与记忆列表和设置页面平级) -->
    <div id="conversation-detail" class="tab-content hidden flex-1 flex flex-col">
      <!-- 头部信息区，固定在顶部 -->
      <div class="sticky top-0 z-10 bg-white border-b pb-2">
        <div class="flex items-center p-3 pb-2">
          <button id="back-to-list" class="text-blue-500 mr-2 hover:bg-gray-100 rounded w-8 h-8 flex items-center justify-center">
            <i class="fas fa-arrow-left"></i>
          </button>
          <div class="flex-1 flex items-center min-w-0 mr-2">
            <h2 id="detail-title" class="text-lg font-medium truncate cursor-pointer flex-1 min-w-0"></h2>
            <input id="detail-title-input" class="text-lg font-medium bg-transparent border border-blue-300 rounded px-2 py-1 outline-none focus:border-blue-500 hidden flex-1 min-w-0" type="text">
          </div>
          <button id="edit-title" class="text-gray-500 hover:bg-gray-100 rounded flex-shrink-0 transition-colors w-8 h-8 flex items-center justify-center">
            <i id="edit-title-icon" class="fas fa-edit"></i>
          </button>
          <!-- 更多操作下拉菜单 -->
          <div class="relative ml-0">
            <button id="more-actions" class="text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors w-8 h-8 flex items-center justify-center rounded" data-i18n-title="moreActions" title="更多操作">
              <i class="fas fa-ellipsis-h"></i>
            </button>
            <!-- 下拉菜单 -->
             <div id="more-actions-dropdown" class="hidden absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded shadow-sm z-50 min-w-[140px] whitespace-nowrap overflow-hidden">
                 <button id="copy-conversation" class="w-full text-left px-3 py-2 text-xs text-gray-600 hover:bg-gray-50 flex items-center transition-colors border-b border-gray-100">
                   <i class="fas fa-copy mr-2 text-gray-400"></i>
                   <span data-i18n="copyConversation">复制对话</span>
                 </button>
                 <button id="open-original" class="w-full text-left px-3 py-2 text-xs text-gray-600 hover:bg-gray-50 flex items-center transition-colors border-b border-gray-100">
                   <i class="fas fa-arrow-up-right-from-square mr-2 text-gray-400"></i>
                   <span data-i18n="openOriginalPage">跳转原网页</span>
                 </button>
                 <button id="delete-conversation-detail" class="w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-red-50 flex items-center transition-colors">
                   <i class="fas fa-trash-alt mr-2 text-red-400"></i>
                   <span data-i18n="delete">删除</span>
                 </button>
               </div>
          </div>
        </div>
        
        <!-- 对话属性，优化间距和对齐 -->
        <div class="flex items-center justify-between text-xs text-gray-500 px-3 gap-2">
          <div class="flex items-center gap-3 flex-1 min-w-0">
            <div id="detail-platform" class="platform-tag"></div>
            <div class="flex items-center gap-1">
              <i class="fas fa-comment-dots opacity-70"></i>
              <span id="detail-messages-count" class="font-medium"></span>
            </div>
          </div>
          <div class="flex items-center gap-1 flex-shrink-0">
            <i class="far fa-clock opacity-70"></i>
            <span id="detail-updated" class="truncate"></span>
          </div>
        </div>
      </div>
      
      <!-- 对话内容，占据更大空间 -->
      <div class="flex-1 overflow-y-auto py-4">
        <div id="detail-messages" class="space-y-3 px-4 pb-4"></div>
      </div>
    </div>
    
    <!-- 修改标题对话框 -->
    <div id="edit-title-modal" class="hidden fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center">
      <div class="bg-white rounded-lg p-4 w-80 shadow-lg">
        <h3 class="text-lg font-medium mb-4" data-i18n="editConversationTitle">修改对话标题</h3>
        <input id="title-input" type="text" class="w-full border rounded p-2 mb-4" data-i18n="inputNewTitle" placeholder="输入新标题">
        <div class="flex justify-end space-x-2">
          <button id="cancel-edit" class="px-4 py-2 border rounded text-gray-700 hover:bg-gray-100" data-i18n="cancel">取消</button>
          <button id="save-title" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600" data-i18n="save">保存</button>
        </div>
      </div>
    </div>
    
    <!-- 删除确认对话框 -->
    <div id="delete-confirm-modal" class="hidden fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center">
      <div class="bg-white rounded-lg p-4 w-80 shadow-lg">
        <h3 class="text-lg font-medium mb-4" data-i18n="confirmDelete">确认删除</h3>
        <p data-i18n="deleteConfirmMessage">确定要删除这个对话记忆吗？删除后将无法恢复。</p>
        <div class="flex justify-end space-x-2 mt-4">
          <button id="cancel-delete" class="px-4 py-2 border rounded text-gray-700 hover:bg-gray-100" data-i18n="cancel">取消</button>
          <button id="confirm-delete" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600" data-i18n="delete">删除</button>
        </div>
      </div>
    </div>
    
    <!-- 设置标签页 -->
    <div id="settings-content" class="tab-content hidden flex-1 overflow-y-auto p-2">
      <!-- 基础设置 -->
      <div class="bg-white rounded-lg shadow-sm p-4 mb-3">
        <h3 class="text-sm font-medium mb-4 flex items-center">
          <i class="fas fa-cog mr-2 text-gray-500"></i><span data-i18n="basicSettings">基础设置</span>
        </h3>
        
        <div class="space-y-4">
          <div class="flex items-center justify-between">
            <div>
              <label class="text-sm font-medium text-gray-700" data-i18n="autoSaveConversations">自动保存对话</label>
              <p class="text-xs text-gray-500 mt-1" data-i18n="autoSaveDescription">在支持的AI对话页面自动保存对话记录</p>

            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <div class="toggle-switch">
                <input type="checkbox" id="auto-save-toggle">
                <div class="toggle-slider"></div>
              </div>
            </label>
          </div>
        </div>
      </div>
      
      <!-- 存储管理 -->
      <div class="bg-white rounded-lg shadow-sm p-4 mb-3">
        <h3 class="text-sm font-medium mb-4 flex items-center">
          <i class="fas fa-database mr-2 text-gray-500"></i><span data-i18n="storageManagement">存储管理</span>
        </h3>
        
        <div class="space-y-4">
          <div class="flex justify-between items-center text-sm">
            <span class="text-gray-600" data-i18n="usedStorage">已使用存储</span>
            <span id="storage-usage" class="font-medium" data-i18n="calculating">计算中...</span>
          </div>
          
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div id="storage-bar" class="bg-blue-600 h-2 rounded-full transition-all" style="width: 0%"></div>
          </div>
          
          <div class="space-y-2">
            <div class="flex gap-2">
              <button id="export-btn" class="flex-1 bg-blue-50 text-blue-600 px-3 py-2 rounded-lg text-sm font-medium hover:bg-blue-100 transition-colors flex items-center justify-center">
                <i class="fas fa-download mr-1.5"></i><span data-i18n="exportData">导出数据</span>
              </button>
              <button id="clear-btn" class="w-12 bg-red-50 text-red-600 px-3 py-2 rounded-lg text-sm font-medium hover:bg-red-100 transition-colors flex items-center justify-center">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            <!-- Cloud Sync Settings Button (Feature 002) -->
            <button id="cloud-sync-settings-btn" class="w-full bg-green-50 text-green-600 px-3 py-2 rounded-lg text-sm font-medium hover:bg-green-100 transition-colors flex items-center justify-center">
              <i class="fas fa-cloud mr-1.5"></i><span data-i18n="cloudSyncSettings">Cloud Sync Settings</span>
            </button>
          </div>
        </div>
      </div>
      
      <!-- 关于信息 -->
      <div class="bg-white rounded-lg shadow-sm p-3 mb-3">
        <h3 class="text-sm font-medium mb-3 flex items-center">
          <i class="fas fa-info-circle mr-2 text-gray-500"></i><span data-i18n="about">关于</span>
        </h3>
        
        <div class="space-y-3 text-sm text-gray-600">
          <div class="flex justify-between">
            <span data-i18n="version">版本</span>
            <span id="version-number" class="font-medium">latest</span>
          </div>
          <div class="flex justify-between">
            <span data-i18n="author">作者</span>
            <span class="font-medium">Eze & Jack</span>
          </div>
          
          <!-- 新增链接区域 -->
          <div class="pt-1">
            <div class="flex">
              <a href="https://github.com/anzchy/chat-memo-pro" target="_blank" class="w-full flex items-center justify-center px-3 py-2 bg-lime-50 text-lime-700 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium border border-lime-200">
                <i class="fas fa-globe mr-1.5"></i>
                <span data-i18n="productWebsite">产品官网</span>
              </a>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 支持平台 -->
      <div class="bg-white rounded-lg shadow-sm p-3 mb-3">
        <h3 class="text-sm font-medium mb-3 flex items-center">
          <i class="fas fa-globe mr-2 text-gray-500"></i><span data-i18n="supportedPlatforms">支持平台</span>
        </h3>
        
        <div class="space-y-2">
          <!-- 支持平台列表将通过 JavaScript 动态生成 -->
        </div>
      </div>
    </div>

    <!-- Cloud Sync Settings (Feature 002) -->
    <div id="sync-content" class="tab-content hidden flex-1 overflow-y-auto p-2">
      <div class="bg-white rounded-lg shadow-sm p-4 mb-3">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-sm font-medium flex items-center">
            <i class="fas fa-cloud mr-2 text-gray-500"></i><span data-i18n="cloudSyncSettings">Cloud Sync Settings</span>
          </h3>
        </div>

        <div class="space-y-4">
          <!-- Setup Instructions -->
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <h4 class="text-sm font-medium text-blue-900 mb-2"><span data-i18n="setupInstructions">Setup Instructions</span></h4>
            <ol class="text-xs text-blue-800 space-y-1 list-decimal list-inside">
              <li data-i18n="setupStep1">Create a free Supabase account at supabase.com</li>
              <li data-i18n="setupStep2">Copy the SQL schema and run it in your Supabase SQL Editor</li>
              <li data-i18n="setupStep3">Enter your Project URL and API Key below</li>
              <li data-i18n="setupStep4">Sign in with your Supabase Auth credentials</li>
            </ol>
            <button id="copy-sql-btn" class="mt-3 w-full bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700 transition-colors">
              <i class="fas fa-copy mr-2"></i><span data-i18n="copySql">Copy SQL Schema</span>
            </button>
          </div>

          <!-- Configuration -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="projectUrl">Project URL</label>
            <input type="text" id="project-url-input" placeholder="https://your-project.supabase.co"
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="anonKey">Anon/Public API Key</label>
            <input type="password" id="anon-key-input" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
          </div>

          <button id="save-config-btn" class="w-full bg-gray-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-gray-700">
            <i class="fas fa-save mr-2"></i><span data-i18n="saveConfiguration">Save Configuration</span>
          </button>

          <!-- Sign In Section -->
          <div id="sign-in-section" class="border-t pt-4">
            <h4 class="text-sm font-medium text-gray-700 mb-3"><span data-i18n="signIn">Sign In</span></h4>
            <div class="space-y-3">
              <div>
                <label class="block text-xs text-gray-600 mb-1" data-i18n="email">Email</label>
                <input type="email" id="email-input" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
              </div>
              <div>
                <label class="block text-xs text-gray-600 mb-1" data-i18n="password">Password</label>
                <input type="password" id="password-input" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
              </div>
              <button id="sign-in-btn" class="w-full bg-blue-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-700">
                <i class="fas fa-sign-in-alt mr-2"></i><span data-i18n="signIn">Sign In</span>
              </button>
              <button id="test-connection-btn" class="w-full bg-yellow-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-yellow-700">
                <i class="fas fa-plug mr-2"></i><span data-i18n="testConnection">Test Connection</span>
              </button>
              <div id="test-connection-result" class="text-sm"></div>
            </div>
          </div>

          <!-- Sign Out Section -->
          <div id="sign-out-section" class="hidden border-t pt-4">
            <div class="text-xs text-gray-600 mb-2">
              <span data-i18n="loggedInAs">Logged in as</span>: <span id="signed-in-email" class="font-medium"></span>
            </div>
            <button id="sign-out-btn" class="w-full bg-red-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-red-700">
              <i class="fas fa-sign-out-alt mr-2"></i><span data-i18n="signOut">Sign Out</span>
            </button>
          </div>

          <!-- Sync Actions -->
          <div id="sync-actions-section" class="hidden border-t pt-4 space-y-2">
            <h4 class="text-sm font-medium text-gray-700 mb-3"><span data-i18n="syncActions">Sync Actions</span></h4>
            <button id="sync-now-btn" class="w-full bg-blue-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-700">
              <i class="fas fa-sync mr-2"></i><span data-i18n="syncNow">Sync Now</span>
            </button>
            <button id="download-from-cloud-btn" class="w-full bg-green-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-green-700">
              <i class="fas fa-cloud-download-alt mr-2"></i><span data-i18n="downloadFromCloud">Download from Cloud</span>
            </button>
            <button id="replace-local-btn" class="w-full bg-orange-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-orange-700">
              <i class="fas fa-cloud-upload-alt mr-2"></i><span data-i18n="replaceLocal">Replace Local with Cloud</span>
            </button>
            <div class="flex gap-2">
              <button id="reset-sync-btn" class="flex-1 bg-yellow-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-yellow-700">
                <i class="fas fa-undo mr-2"></i><span data-i18n="resetSync">Reset Sync</span>
              </button>
              <button id="force-resync-btn" class="flex-1 bg-purple-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-purple-700">
                <i class="fas fa-redo mr-2"></i><span data-i18n="forceResync">Force Resync</span>
              </button>
            </div>
            <button id="retry-failed-btn" class="w-full bg-gray-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-gray-700">
              <i class="fas fa-redo mr-2"></i><span data-i18n="retryFailed">Retry Failed Items</span>
            </button>
            <button id="restore-deleted-btn" class="w-full bg-teal-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-teal-700">
              <i class="fas fa-undo mr-2"></i><span data-i18n="restoreDeleted">Restore Deleted (Cloud)</span>
            </button>
          </div>

          <!-- Auto-Sync Settings -->
          <div class="border-t pt-4">
            <h4 class="text-sm font-medium text-gray-700 mb-3"><span data-i18n="autoSync">Auto-Sync</span></h4>
            <div class="flex items-center justify-between mb-3">
              <label class="text-sm text-gray-700" data-i18n="enableAutoSync">Enable Auto-Sync</label>
              <label class="toggle-switch">
                <input type="checkbox" id="auto-sync-toggle">
                <div class="toggle-slider"></div>
              </label>
            </div>
            <div>
              <label class="block text-xs text-gray-600 mb-1" data-i18n="syncInterval">Sync Interval</label>
              <select id="sync-interval-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                <option value="5">5 minutes</option>
                <option value="15" selected>15 minutes</option>
                <option value="30">30 minutes</option>
                <option value="60">1 hour</option>
                <option value="120">2 hours</option>
              </select>
            </div>
          </div>

          <!-- Status Panel -->
          <div class="border-t pt-4">
            <h4 class="text-sm font-medium text-gray-700 mb-3"><span data-i18n="syncStatus">Sync Status</span></h4>
            <div id="sync-status-panel" class="text-sm text-gray-600 space-y-1"></div>
            <div id="sync-progress-indicator" class="hidden mt-2 p-2 bg-blue-50 rounded"></div>
          </div>

          <!-- Sync History -->
          <div class="border-t pt-4">
            <h4 class="text-sm font-medium text-gray-700 mb-3"><span data-i18n="syncHistory">Sync History</span></h4>
            <div id="sync-history-list" class="text-sm text-gray-600 max-h-48 overflow-y-auto"></div>
          </div>

          <!-- Advanced Settings -->
          <div class="border-t pt-4">
            <h4 class="text-sm font-medium text-gray-700 mb-3"><span data-i18n="advanced">Advanced</span></h4>
            <div class="flex items-center justify-between">
              <label class="text-sm text-gray-700" data-i18n="verboseLogging">Verbose Logging</label>
              <label class="toggle-switch">
                <input type="checkbox" id="verbose-logging-toggle">
                <div class="toggle-slider"></div>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 侧边栏导航 -->
  <div class="sidebar">
    <div class="sidebar-spacer"></div>
    <button id="tab-memories" class="sidebar-btn active">
      <i class="fas fa-brain"></i>
    </button>
    <button id="tab-settings" class="sidebar-btn">
      <i class="fas fa-cog"></i>
    </button>
    <button id="tab-sync" class="sidebar-btn" data-i18n-title="cloudSyncSettings">
      <i class="fas fa-cloud"></i>
    </button>
    
    <!-- 底部联系我们按钮 -->
    <button id="contact-us" class="sidebar-btn contact-btn" data-i18n-title="contactUs">
      <i class="fas fa-headset"></i>
    </button>
  </div>
  
  <!-- 清空数据确认弹窗 -->
  <div id="clear-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-sm mx-4 shadow-xl">
      <div class="text-center">
        <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900 mb-2" data-i18n="confirmClearAllData">确认清空所有数据？</h3>
        <p class="text-sm text-gray-500 mb-2" data-i18n="clearDataWarning">此操作将永久删除所有保存的对话记录，且无法恢复。</p>
        <p class="text-sm text-blue-600 mb-6" data-i18n="refreshPageAfterClear">清空完成后，请刷新网页以确保数据同步。</p>
        <div class="flex gap-3">
          <button id="cancel-clear" class="flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors" data-i18n="cancel">
            取消
          </button>
          <button id="confirm-clear" class="flex-1 px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors" data-i18n="confirmClear">
            确认清空
          </button>
        </div>
      </div>
    </div>
  </div>

    <!-- 导出向导弹窗 -->
    <div id="export-wizard-modal" class="hidden fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center">
      <div class="bg-white rounded-lg w-[500px] shadow-xl flex flex-col max-h-[90vh]">
        <!-- Header -->
        <div class="p-4 border-b flex justify-between items-center">
          <h3 class="text-lg font-medium text-gray-900" data-i18n="exportWizard">导出向导</h3>
          <button id="close-export-wizard" class="text-gray-400 hover:text-gray-600">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <!-- Content -->
        <div class="p-6 flex-1 overflow-y-auto">
          <!-- Step 1: Time Range -->
          <div id="export-step-1" class="wizard-step">
            <h4 class="text-sm font-medium text-gray-700 mb-3" data-i18n="selectTimeRange">1. 选择时间范围</h4>
            <div class="grid grid-cols-3 gap-2 mb-4">
              <button class="export-time-option px-3 py-2 text-xs border rounded-md hover:bg-blue-50 hover:border-blue-500 transition-all" data-value="all" data-i18n="allTime">全部时间</button>
              <button class="export-time-option px-3 py-2 text-xs border rounded-md hover:bg-blue-50 hover:border-blue-500 transition-all" data-value="week" data-i18n="lastWeek">最近一周</button>
              <button class="export-time-option px-3 py-2 text-xs border rounded-md hover:bg-blue-50 hover:border-blue-500 transition-all" data-value="month" data-i18n="lastMonth">最近一月</button>
              <button class="export-time-option px-3 py-2 text-xs border rounded-md hover:bg-blue-50 hover:border-blue-500 transition-all" data-value="3months" data-i18n="last3Months">最近三月</button>
              <button class="export-time-option px-3 py-2 text-xs border rounded-md hover:bg-blue-50 hover:border-blue-500 transition-all" data-value="year" data-i18n="lastYear">最近一年</button>
              <button class="export-time-option px-3 py-2 text-xs border rounded-md hover:bg-blue-50 hover:border-blue-500 transition-all" data-value="custom" data-i18n="customRange">自定义</button>
            </div>
            
            <div id="export-custom-date" class="hidden grid grid-cols-2 gap-3 mb-4 bg-gray-50 p-3 rounded-md">
              <div>
                <label class="block text-xs text-gray-500 mb-1" data-i18n="startDate">开始日期</label>
                <input type="date" id="export-start-date" class="w-full text-xs border rounded px-2 py-1">
              </div>
              <div>
                <label class="block text-xs text-gray-500 mb-1" data-i18n="endDate">结束日期</label>
                <input type="date" id="export-end-date" class="w-full text-xs border rounded px-2 py-1">
              </div>
            </div>
          </div>
          
          <!-- Step 2: Export Mode -->
          <div id="export-step-2" class="wizard-step mt-6">
            <h4 class="text-sm font-medium text-gray-700 mb-3" data-i18n="selectExportMode">2. 选择导出模式</h4>
            <div class="grid grid-cols-2 gap-3">
              <button class="export-mode-option p-3 border rounded-md hover:bg-blue-50 hover:border-blue-500 transition-all flex flex-col items-center text-center" data-value="multiple">
                <i class="fas fa-file-archive text-2xl text-gray-400 mb-2"></i>
                <span class="text-xs font-medium" data-i18n="multipleFilesZIP">多文件 (ZIP)</span>
                <span class="text-[10px] text-gray-500 mt-1">每个对话一个文件</span>
              </button>
              <button class="export-mode-option p-3 border rounded-md hover:bg-blue-50 hover:border-blue-500 transition-all flex flex-col items-center text-center" data-value="single">
                <i class="fas fa-file-alt text-2xl text-gray-400 mb-2"></i>
                <span class="text-xs font-medium" data-i18n="singleDocument">单文件</span>
                <span class="text-[10px] text-gray-500 mt-1">合并所有对话</span>
              </button>
            </div>
          </div>
          
          <!-- Step 3: File Format -->
          <div id="export-step-3" class="wizard-step mt-6">
            <h4 class="text-sm font-medium text-gray-700 mb-3" data-i18n="selectFileFormat">3. 选择文件格式</h4>
            <div class="grid grid-cols-3 gap-2">
              <button class="export-format-option px-3 py-2 text-xs border rounded-md hover:bg-blue-50 hover:border-blue-500 transition-all flex items-center justify-center" data-value="markdown">
                <i class="fab fa-markdown mr-1.5"></i>Markdown
              </button>
              <button class="export-format-option px-3 py-2 text-xs border rounded-md hover:bg-blue-50 hover:border-blue-500 transition-all flex items-center justify-center" data-value="json">
                <i class="fas fa-code mr-1.5"></i>JSON
              </button>
              <button class="export-format-option px-3 py-2 text-xs border rounded-md hover:bg-blue-50 hover:border-blue-500 transition-all flex items-center justify-center" data-value="txt">
                <i class="fas fa-align-left mr-1.5"></i>Text
              </button>
            </div>
          </div>
          
          <!-- Preview Card -->
          <div id="export-preview" class="mt-6 bg-blue-50 rounded-lg p-4 border border-blue-100">
            <h4 class="text-xs font-medium text-blue-800 mb-2 flex items-center">
              <i class="fas fa-info-circle mr-1.5"></i><span data-i18n="exportPreview">导出预览</span>
            </h4>
            <div class="text-xs text-blue-700 space-y-1">
              <div class="flex justify-between">
                <span data-i18n="conversationsCount">对话数量:</span>
                <span id="preview-count" class="font-medium">0</span>
              </div>
              <div class="flex justify-between">
                <span data-i18n="estimatedSize">预计大小:</span>
                <span id="preview-size" class="font-medium">0 KB</span>
              </div>
              <div class="flex justify-between">
                <span data-i18n="outputFormat">输出格式:</span>
                <span id="preview-format" class="font-medium">-</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Footer -->
        <div class="p-4 border-t flex justify-end gap-3 bg-gray-50 rounded-b-lg">
          <button id="cancel-export-wizard" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50" data-i18n="cancel">取消</button>
          <button id="start-export-btn" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed flex items-center" disabled>
            <i class="fas fa-download mr-1.5"></i>
            <span data-i18n="startExport">开始导出</span>
          </button>
        </div>
      </div>
    </div>

  <!-- Toast 容器 - 底部居中（排除侧边栏） -->
  <div id="toast-container" class="fixed bottom-6 z-50 pointer-events-none" style="left: calc(50% - 30px); transform: translateX(-50%);"></div>

  <script src="../js/i18n.js"></script>
  <script src="../js/core/compatibility.js"></script>
  <script src="../lib/jszip.min.js"></script>
  <script src="../lib/fuse.min.js"></script>
  <script src="../js/resizable-panel.js"></script>
  <!-- Cloud Sync UI (Feature 002) -->
  <script type="module" src="../js/sync/sync-ui-entry.js"></script>
  <script src="../js/popup.js"></script>
</body>
</html>
