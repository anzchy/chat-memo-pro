# å¹³å°é€‚é…æ–¹æ¡ˆå®Œæ•´åˆ†æ

## ä» chat_memo_research_report_v2.md æå–çš„åŸºç¡€ä¿¡æ¯

### Gemini Pro é€‚é…
- URL: `https://gemini.google.com/app/*`
- å®é™…æµ‹è¯• URL: `https://gemini.google.com/app/b513894b1b9bb1f2`
- ä¸»å®¹å™¨: `main`
- ç‰¹ç‚¹: 
  - ä½¿ç”¨ SPA æ¶æ„ï¼ŒURL ä¼šåŠ¨æ€å˜åŒ–
  - æ¶ˆæ¯æ˜¾ç¤ºåœ¨ä¸»å®¹å™¨ä¸­
  - éœ€è¦é‡è¯•æœºåˆ¶ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ

å®é™… DOM ç»“æ„ï¼ˆåŸºäºæµ‹è¯•ï¼‰:
- ç”¨æˆ·æ¶ˆæ¯æ˜¾ç¤ºåœ¨å³ä¾§æ·±è‰²æ°”æ³¡ä¸­
- AI æ¶ˆæ¯æ˜¾ç¤ºåœ¨å·¦ä¾§æµ…è‰²åŒºåŸŸ
- éœ€è¦é€šè¿‡ç±»åæˆ–æ–‡æœ¬å†…å®¹æ¥åŒºåˆ†è§’è‰²
- å»ºè®®ä½¿ç”¨å¤šå±‚ fallback é€‰æ‹©å™¨ç­–ç•¥

### Claude é€‚é…
- URL: `https://claude.ai/chat/*`
- Selectors:
  - container: `[data-conversation-turn]`
  - userMessage: `[data-role="user"]`
  - aiMessage: `[data-role="assistant"]`
  - thinking: `.thinking-indicator`
  - artifact: `.artifact-container`
- ç‰¹æ€§: æ”¯æŒ Thinking è¿‡ç¨‹ã€Artifactsã€æ¶ˆæ¯é‡æ–°ç”Ÿæˆ

### ChatGPT é€‚é…
- URL: `https://chat.openai.com/c/*` æˆ– `https://chatgpt.com/*`
- Selectors:
  - container: `[data-testid="conversation-turn"]`
  - message: `.markdown`
  - role: `data-message-author-role` (å±æ€§)
  - codeBlock: `pre code`
- ç‰¹æ€§: æ”¯æŒ Markdownã€ä»£ç å—ã€å›¾ç‰‡

## æ–°å¢å¹³å°åˆ†æ

### Genspark.ai é€‚é…

**URL æ¨¡å¼**:
- ä¸»é¡µ: `https://www.genspark.ai/`
- å¯¹è¯é¡µé¢: `https://www.genspark.ai/agents?id=<conversation_id>`
- ç¤ºä¾‹: `https://www.genspark.ai/agents?id=8fd43b61-56a1-41a8-b5de-acb120da0752`

**å¹³å°ç‰¹ç‚¹**:
- å¤šåŠŸèƒ½ AI å·¥ä½œç©ºé—´ï¼ˆAI Workspaceï¼‰
- æ”¯æŒå¤šç§ AI å·¥å…·ï¼šSuper Agentã€AI Chatã€AI Slidesã€AI Docs ç­‰
- å¯¹è¯é‡‡ç”¨ Super Agent æ¨¡å¼
- æœ‰æ¸…æ™°çš„ç”¨æˆ·æ¶ˆæ¯å’Œ AI å“åº”åŒºåˆ†

**DOM ç»“æ„**ï¼ˆåŸºäºå®é™…æµ‹è¯•ï¼‰:
- ä¸»å®¹å™¨: éœ€è¦æŸ¥æ‰¾å¯¹è¯å®¹å™¨
- ç”¨æˆ·æ¶ˆæ¯: æ˜¾ç¤ºåœ¨å¯¹è¯æµä¸­ï¼Œå³ä¾§å¯¹é½
- AI å“åº”: æ˜¾ç¤ºåœ¨å¯¹è¯æµä¸­ï¼Œå·¦ä¾§å¯¹é½ï¼ŒåŒ…å« Markdown æ ¼å¼
- é¡µé¢æ ‡é¢˜ä¼šæ›´æ–°ä¸ºå¯¹è¯ä¸»é¢˜

**å»ºè®®é€‰æ‹©å™¨**:
```javascript
const gensparkAdapter = {
  name: 'genspark',
  url: 'genspark.ai/agents',
  urlPattern: /^https:\/\/www\.genspark\.ai\/agents\?id=/,
  selectors: {
    container: 'main, [role="main"], .conversation-container',
    userMessage: '[class*="user"], [class*="query"]',
    aiMessage: '[class*="assistant"], [class*="response"]',
  }
};
```

### Manus é€‚é…

#### URL æ¨¡å¼

```typescript
urlPattern = /^https:\/\/manus\.im\/app/;
```

æ”¯æŒçš„ URLï¼š

- ä¸»é¡µ: `https://manus.im/app`
- ä»»åŠ¡é¡µé¢: `https://manus.im/app/<task_id>`
- ç¤ºä¾‹: `https://manus.im/app/V8Gl1FEzaqOJTEchQ0CPAJ`

#### æ ¸å¿ƒæŒ‘æˆ˜

Manus ä¸ä¼ ç»Ÿå¯¹è¯å‹ AIï¼ˆChatGPTã€Geminiã€Claudeï¼‰çš„ä¸»è¦åŒºåˆ«ï¼š

1. **ä»»åŠ¡å¯¼å‘**: æ¯ä¸ªå¯¹è¯æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ï¼Œè€Œéè¿ç»­å¯¹è¯æµ
2. **å¤æ‚å“åº”ç»“æ„**: AI å“åº”åŒ…å«å¤šä¸ªéƒ¨åˆ†ï¼ˆåˆå§‹å›å¤ã€æ€è€ƒè¿‡ç¨‹ã€æ“ä½œæ­¥éª¤ã€æœ€ç»ˆç»“æœã€ä»£ç æ–‡ä»¶ã€ç»ˆç«¯è¾“å‡ºï¼‰
3. **ç¼ºå°‘æ˜ç¡®çš„æ¶ˆæ¯å®¹å™¨**: æ²¡æœ‰ç±»ä¼¼ `[data-role="user"]` çš„è¯­ä¹‰åŒ–æ ‡è®°
4. **åŠ¨æ€å†…å®¹**: é¡µé¢å†…å®¹éšç€ä»»åŠ¡æ‰§è¡ŒåŠ¨æ€æ›´æ–°

#### è§£å†³æ–¹æ¡ˆ

é‡‡ç”¨**åŸºäºæ–‡æœ¬å†…å®¹åˆ†æçš„å¯å‘å¼æ–¹æ³•**ï¼š

##### 1. ç”¨æˆ·æ¶ˆæ¯æå–

```typescript
private findUserMessage(): string | null {
  // ç­–ç•¥ï¼šæŸ¥æ‰¾ AI å“åº”æ¨¡å¼ä¹‹å‰çš„æ–‡æœ¬
  const aiResponsePatterns = [
    'å¥½çš„ï¼', 'æ”¶åˆ°ï¼', 'æ˜ç™½äº†',
    'I am currently', 'Let me', 'I will'
  ];
  
  // æŸ¥æ‰¾ç¬¦åˆç”¨æˆ·æ¶ˆæ¯ç‰¹å¾çš„æ–‡æœ¬
  if (this.looksLikeUserMessage(line)) {
    return line;
  }
}
```

**è¯†åˆ«ç‰¹å¾**ï¼š

- å‡ºç°åœ¨ AI å“åº”ä¹‹å‰
- åŒ…å«é—®é¢˜æˆ–è¯·æ±‚å…³é”®è¯ï¼ˆ"å¦‚ä½•"ã€"æ€ä¹ˆ"ã€"å†™ä¸€ä¸ª"ã€"å¸®æˆ‘"ç­‰ï¼‰
- é•¿åº¦é€‚ä¸­ï¼ˆé€šå¸¸ < 500 å­—ç¬¦ï¼‰
- ä¸åŒ…å«ä»£ç å—æˆ–ç»“æ„åŒ–è¾“å‡º

##### 2. AI å“åº”æå–

```typescript
private extractAIResponse(): string | null {
  // ç­–ç•¥ï¼šä» AI å“åº”èµ·å§‹æ¨¡å¼å¼€å§‹æ•è·
  const aiStartPatterns = [
    'å¥½çš„ï¼', 'æ”¶åˆ°ï¼', 'æ˜ç™½äº†',
    'I am currently', 'å·²å®Œæˆ'
  ];
  
  // æŒç»­æ•è·ç›´åˆ°é‡åˆ°è¾¹ç•Œæ ‡è®°
  const stopPatterns = [
    'Send message to Manus',
    'How was this result?',
    'Suggested follow-ups'
  ];
}
```

**æå–å†…å®¹**ï¼š

- åˆå§‹å›å¤
- æ€è€ƒè¿‡ç¨‹ï¼ˆ"ç¼–å†™å†’æ³¡æ’åºç®—æ³•ä»£ç "ã€"I am currently implementing..."ï¼‰
- æ“ä½œæ­¥éª¤ï¼ˆ"Creating file bubble_sort.py"ã€"Executing command..."ï¼‰
- æœ€ç»ˆç»“æœï¼ˆ"å·²å®Œæˆ Python å†’æ³¡æ’åºç®—æ³•å®ç°ï¼..."ï¼‰
- ç»ˆç«¯è¾“å‡º

##### 3. UI å…ƒç´ è¿‡æ»¤

```typescript
private isUIElement(text: string): boolean {
  const uiPatterns = [
    'New task', 'Search', 'Library', 'Projects',
    'Share Manus', 'Manus 1.5', 'ä¼˜åŒ–æŒ‡ä»¤'
  ];
  return uiPatterns.some(pattern => text.includes(pattern));
}
```

è¿‡æ»¤æ‰å¯¼èˆªæ ã€ä¾§è¾¹æ ã€æŒ‰é’®ç­‰ UI å…ƒç´ æ–‡æœ¬ã€‚

#### æŠ€æœ¯å®ç°

##### é‡è¯•æœºåˆ¶

```typescript
observe() {
  const container = document.querySelector('main') || 
                   document.querySelector('[role="main"]') ||
                   document.querySelector('body');
  
  if (!container && this.retryCount < this.maxRetries) {
    this.retryCount++;
    setTimeout(() => this.observe(), 1000);
    return;
  }
}
```

æœ€å¤šé‡è¯• 10 æ¬¡ï¼Œæ¯æ¬¡é—´éš” 1 ç§’ï¼Œç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½ã€‚

##### å»é‡æœºåˆ¶

```typescript
private lastExtractedContent = '';

private handleMutation() {
  const currentContent = JSON.stringify(messages);
  if (currentContent !== this.lastExtractedContent) {
    this.lastExtractedContent = currentContent;
    // ä¿å­˜æ¶ˆæ¯
  }
}
```

é¿å…é‡å¤ä¿å­˜ç›¸åŒå†…å®¹ã€‚

##### MutationObserver

ä½¿ç”¨ `ContentObserver` ç›‘å¬ DOM å˜åŒ–ï¼Œè‡ªåŠ¨æ•è·æ–°å†…å®¹ã€‚



## æ ¸å¿ƒå®ç°æ¨¡å¼æ€»ç»“

æ‰€æœ‰é€‚é…å™¨éƒ½åº”éµå¾ªä»¥ä¸‹æ¨¡å¼ï¼š

1. **URL åŒ¹é…**: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¹³å° URL
2. **å®¹å™¨æŸ¥æ‰¾**: ä½¿ç”¨ `querySelector` æŸ¥æ‰¾ä¸»å¯¹è¯å®¹å™¨
3. **é‡è¯•æœºåˆ¶**: é¡µé¢åŠ è½½æ—¶å®¹å™¨å¯èƒ½ä¸å­˜åœ¨ï¼Œéœ€è¦é‡è¯•ï¼ˆå»ºè®® 10 æ¬¡ï¼Œæ¯æ¬¡é—´éš” 1 ç§’ï¼‰
4. **MutationObserver**: ç›‘å¬ DOM å˜åŒ–ä»¥æ•è·æ–°æ¶ˆæ¯
5. **é˜²æŠ–å¤„ç†**: ä½¿ç”¨ debounce é¿å…é¢‘ç¹è§¦å‘ï¼ˆå»ºè®® 1000msï¼‰
6. **æ¶ˆæ¯æå–**: 
   - ä¼˜å…ˆä½¿ç”¨ `data-role` ç­‰è¯­ä¹‰åŒ–å±æ€§
   - æä¾› fallback é€‰æ‹©å™¨ï¼ˆç±»åã€ç»“æ„ç­‰ï¼‰
   - è¿‡æ»¤æ— å…³å†…å®¹ï¼ˆå¦‚æç¤ºæ–‡æœ¬ã€UI å…ƒç´ ï¼‰
7. **æ¶ˆæ¯å‘é€**: é€šè¿‡ `chrome.runtime.sendMessage` å‘é€åˆ° background

## å®ç°ä¼˜å…ˆçº§

1. âœ… **Gemini** - å·²ä¿®å¤
2. âœ… **ChatGPT** - å·²ä¿®å¤
3. âœ… **Claude** - å·²ä¿®å¤
4. ğŸ”„ **Genspark** - å¾…å®ç°
5. âŒ **Manus** - ä¸é€‚ç”¨
